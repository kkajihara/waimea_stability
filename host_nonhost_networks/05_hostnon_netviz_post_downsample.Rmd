---
title: "02_hostenv_netviz"
output: html_document
date: "2024-04-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(SpiecEasi)
library(igraph)
library(ggnetwork)
library(intergraph)
library(ggpubr)

options(bitmapType='cairo')

```

Get metadata and otu names for each plot network

```{r}
fung_data <- readRDS("../intermediates/hostnon/fung_hostnon_abun_for_networks.rds")  
bact_data <- readRDS("../intermediates/hostnon/bact_hostnon_abun_for_networks.rds")

fung_meta <- readRDS("../intermediates/global/fully_filtered_p20_fungal_otu_metadata_matched_up.rds")
bact_meta <- readRDS("../intermediates/global/fully_filtered_p20_bact_otu_metadata_matched_up.rds")


df <- data.frame(fungi = unlist(lapply(fung_data, function(x) dim(x)[1])),
                 bacteria = unlist(lapply(bact_data, function(x) dim(x)[1])))
df$interkingdom <- df$fungi + df$bacteria

```

## ITS

```{r}

## visualization
fung_igraphs <- readRDS("../intermediates/hostnon/downsampled_fung_hostnon_network.rds")

empo1 <- c("Free-living", "Host-associated")


 
fung_net_plots <- list()

for (i in 1:length(fung_igraphs)) {
  set.seed(123)
  
  gg <- ggplot(ggnetwork(asNetwork(fung_igraphs[[i]]), layout = "fruchtermanreingold"), aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(color = "grey20", size = 0.1) +
  geom_nodes(color = "#1F78B4") +
  theme_blank() +
  #scale_color_brewer(palette = "Paired") + # "#A6CEE3" "#1F78B4"
  labs(title = empo1[i])
  
  fung_net_plots[[i]] <- gg
}

#names(fung_net_plots) <- empo1

all_fung <- ggarrange(plotlist = fung_net_plots,
                      ncol = 2,
                      nrow = 1) + bgcolor("white")

ggsave("../figures/finals/hostnon/downsamp_fung_hostnon_network_plots.png", all_fung, width=12.5, height=6)

```

# 16S

```{r}
## visualization
bact_igraphs <- readRDS("../intermediates/hostnon/downsampled_bact_hostnon_network.rds")

bact_net_plots <- list()

for (i in 1:length(bact_igraphs)) {
  set.seed(123)
  
  gg <- ggplot(ggnetwork(asNetwork(bact_igraphs[[i]]), layout = "fruchtermanreingold"), aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(color = "grey20", size = 0.1) +
  geom_nodes(color = "#A6CEE3") +
  theme_blank() +
  #scale_color_brewer(palette = "Paired") + # "#A6CEE3" "#1F78B4"
  labs(title = empo1[i])
  
  print("one plot done")
  
  bact_net_plots[[i]] <- gg
}

names(bact_net_plots) <- empo1

all_bact <- ggarrange(plotlist = bact_net_plots,
                      ncol = 2,
                      nrow = 1) + bgcolor("white")

ggsave("../figures/finals/hostnon/downsamp_bact_hostnon_network_plots.png", all_bact, width=12.5, height=6)

```

## Cross-domain

```{r}
cross_igraphs <- readRDS("../intermediates/hostnon/downsampled_cross_hostnon_network.rds")

## visualization
cross_net_plots <- list()

for (i in 1:length(cross_igraphs)) {
  set.seed(123)
  
  dat <- ggnetwork(asNetwork(cross_igraphs[[i]]), layout = "fruchtermanreingold")
  dat$domain <- ifelse(grepl("fung", dat$vertex.names), "Fungi", "Bacteria")

  
  gg <- ggplot(dat, aes(x = x, y = y, xend = xend, yend = yend)) +
  geom_edges(color = "grey20", size = 0.1) +
  geom_nodes(aes(color = domain)) +
  theme_blank() +
  scale_color_brewer(palette = "Paired") + # "#A6CEE3" "#1F78B4" +
    guides(color = guide_legend(override.aes = list(size=5))) +
  labs(title = empo1[i], color = "Domain")
  
  cross_net_plots[[i]] <- gg
}


all_cross <- ggarrange(plotlist = cross_net_plots,
                      ncol = 2,
                      nrow = 1,
                      common.legend = TRUE,
                      legend = "bottom") + bgcolor("white")

ggsave("../figures/finals/hostnon/dowmsamp_cross_hostnon_network_plots.png",all_cross, width=13, height=6.5)

```



